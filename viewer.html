<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>dev-docs</title>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,300;0,400;0,500;0,600;1,400&family=IBM+Plex+Sans:wght@300;400;500&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.6/marked.min.js"></script>
  <style>
    :root {
      --bg: #0d0d0d;
      --sidebar: #131313;
      --panel: #111;
      --border: #222;
      --border-dim: #1a1a1a;
      --text: #c8c8c8;
      --text-dim: #555;
      --text-dimmer: #333;
      --accent: #c5f135;
      --accent-bg: rgba(197, 241, 53, 0.07);
      --accent-border: rgba(197, 241, 53, 0.2);
      --mono: 'IBM Plex Mono', monospace;
      --sans: 'IBM Plex Sans', sans-serif;
      --red: #ff5f5f;
      --blue: #5fb4ff;
    }

    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: var(--mono);
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* ‚îÄ‚îÄ Topbar ‚îÄ‚îÄ */
    header {
      height: 44px;
      display: flex;
      align-items: center;
      padding: 0 20px;
      border-bottom: 1px solid var(--border);
      background: var(--sidebar);
      gap: 20px;
      flex-shrink: 0;
    }

    .logo {
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.25em;
      text-transform: uppercase;
      color: var(--accent);
    }

    .logo span { color: var(--text-dim); font-weight: 300; }

    .server-hint {
      font-size: 11px;
      color: var(--text-dim);
      margin-left: auto;
    }

    .server-hint code {
      color: var(--text);
      background: var(--border-dim);
      padding: 2px 7px;
      border-radius: 3px;
      font-size: 11px;
    }

    /* ‚îÄ‚îÄ Layout ‚îÄ‚îÄ */
    .layout {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    /* ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ */
    aside {
      width: 220px;
      flex-shrink: 0;
      background: var(--sidebar);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
    }

    .aside-top {
      padding: 14px 14px 10px;
      border-bottom: 1px solid var(--border-dim);
    }

    .section-label {
      font-size: 9.5px;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      color: var(--text-dimmer);
      margin-bottom: 10px;
      padding: 0 2px;
    }

    /* View toggle */
    .toggle {
      display: flex;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 4px;
      overflow: hidden;
    }

    .toggle button {
      flex: 1;
      padding: 7px 0;
      background: transparent;
      border: none;
      color: var(--text-dim);
      font-family: var(--mono);
      font-size: 11px;
      cursor: pointer;
      transition: all 0.12s;
      letter-spacing: 0.05em;
    }

    .toggle button.on {
      background: var(--accent);
      color: #000;
      font-weight: 600;
    }

    /* Package list */
    .pkg-list {
      flex: 1;
      overflow-y: auto;
      padding: 8px;
    }

    .pkg-empty {
      padding: 16px 8px;
      font-size: 11.5px;
      color: var(--text-dim);
      line-height: 1.8;
    }
    .pkg-empty code {
      color: var(--accent);
      background: var(--accent-bg);
      padding: 1px 5px;
      border-radius: 3px;
    }

    .pkg-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 9px 10px;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.1s, color 0.1s;
      margin-bottom: 2px;
    }

    .pkg-item:hover { background: var(--accent-bg); color: var(--accent); }

    .pkg-item.active {
      background: var(--accent-bg);
      color: var(--accent);
      outline: 1px solid var(--accent-border);
    }

    .pkg-name { font-size: 13px; font-weight: 500; }

    .pkg-tag {
      font-size: 9.5px;
      padding: 2px 6px;
      border-radius: 3px;
      background: var(--border-dim);
      color: var(--text-dim);
      letter-spacing: 0.05em;
    }

    .pkg-item.active .pkg-tag {
      background: rgba(197, 241, 53, 0.12);
      color: var(--accent);
    }

    /* ‚îÄ‚îÄ Content ‚îÄ‚îÄ */
    main {
      flex: 1;
      overflow: hidden;
      position: relative;
      background: var(--bg);
    }

    iframe#doc-frame {
      width: 100%; height: 100%;
      border: none;
      display: none;
      background: #fff;
    }

    #md-panel {
      width: 100%; height: 100%;
      overflow-y: auto;
      padding: 52px 60px;
      display: none;
    }

    .md-body {
      max-width: 820px;
      margin: 0 auto;
      font-family: var(--sans);
      font-size: 15px;
      line-height: 1.75;
      color: #ccc;
    }

    .md-body h1 { font-size: 30px; font-weight: 500; color: #fff; margin-bottom: 20px; line-height: 1.2; }
    .md-body h2 { font-size: 20px; font-weight: 500; color: #e0e0e0; margin: 40px 0 14px; padding-top: 20px; border-top: 1px solid var(--border-dim); }
    .md-body h3 { font-size: 15px; font-weight: 500; color: #ccc; margin: 28px 0 10px; }
    .md-body h4 { font-size: 14px; color: #aaa; margin: 20px 0 8px; }
    .md-body p { margin-bottom: 16px; }
    .md-body a { color: var(--accent); text-decoration: none; }
    .md-body a:hover { text-decoration: underline; }
    .md-body code { font-family: var(--mono); font-size: 13px; background: #1a1a1a; color: var(--accent); padding: 1px 6px; border-radius: 4px; }
    .md-body pre { background: #141414; border: 1px solid var(--border); border-radius: 7px; padding: 22px 24px; overflow-x: auto; margin: 20px 0; }
    .md-body pre code { background: none; padding: 0; color: #d4d4d4; font-size: 13px; }
    .md-body ul, .md-body ol { padding-left: 22px; margin-bottom: 16px; }
    .md-body li { margin-bottom: 8px; }
    .md-body blockquote { border-left: 3px solid var(--accent); margin: 20px 0; padding: 10px 18px; background: var(--accent-bg); color: #aaa; border-radius: 0 5px 5px 0; }
    .md-body table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 13.5px; }
    .md-body th { text-align: left; padding: 10px 14px; background: #1a1a1a; color: #fff; font-weight: 500; border-bottom: 2px solid var(--accent); }
    .md-body td { padding: 9px 14px; border-bottom: 1px solid var(--border-dim); }
    .md-body hr { border: none; border-top: 1px solid var(--border); margin: 32px 0; }
    .md-body strong { color: #e0e0e0; font-weight: 600; }
    .md-body em { color: #aaa; }

    /* Copilot panel */
    #copilot-panel {
      width: 100%; height: 100%;
      overflow-y: auto;
      padding: 48px 60px;
      display: none;
    }

    .copilot-body {
      max-width: 740px;
      margin: 0 auto;
    }

    .copilot-heading {
      font-size: 11px;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 6px;
    }

    .copilot-sub {
      font-size: 13px;
      color: var(--text-dim);
      font-family: var(--sans);
      margin-bottom: 28px;
      line-height: 1.6;
    }

    .copilot-sub code {
      font-family: var(--mono);
      font-size: 12px;
      color: var(--text);
      background: var(--border-dim);
      padding: 1px 6px;
      border-radius: 3px;
    }

    .code-block {
      position: relative;
      background: #111;
      border: 1px solid var(--border);
      border-radius: 7px;
      padding: 22px 24px;
      font-size: 12px;
      line-height: 1.9;
      white-space: pre;
      overflow-x: auto;
      color: #bbb;
    }

    .code-block .key { color: var(--blue); }
    .code-block .str { color: #ce9178; }
    .code-block .acc { color: var(--accent); }

    .copy-btn {
      position: absolute;
      top: 12px; right: 12px;
      padding: 5px 14px;
      background: var(--accent);
      color: #000;
      border: none;
      border-radius: 4px;
      font-family: var(--mono);
      font-size: 11px;
      font-weight: 700;
      cursor: pointer;
      letter-spacing: 0.05em;
      transition: opacity 0.15s;
    }
    .copy-btn:hover { opacity: 0.85; }

    .files-section { margin-top: 32px; }

    .files-label {
      font-size: 10px;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--text-dimmer);
      margin-bottom: 10px;
    }

    .file-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 5px 10px;
      border: 1px solid var(--border);
      border-radius: 4px;
      font-size: 11px;
      color: var(--text-dim);
      margin: 3px;
      line-height: 1;
    }

    /* Empty / loading states */
    .state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      gap: 14px;
      color: var(--text-dim);
      text-align: center;
    }

    .state-icon { font-size: 40px; opacity: 0.4; }
    .state-title { font-size: 14px; letter-spacing: 0.05em; }
    .state-sub { font-size: 12px; color: var(--text-dimmer); max-width: 340px; line-height: 1.7; }

    /* Scrollbars */
    ::-webkit-scrollbar { width: 5px; height: 5px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #2a2a2a; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #3a3a3a; }
  </style>
</head>
<body>
  <header>
    <div class="logo">dev<span>-</span>docs</div>
    <div class="server-hint">serve with: <code>python3.14 -m http.server 8080</code></div>
  </header>

  <div class="layout">
    <aside>
      <div class="aside-top">
        <div class="section-label">packages</div>
        <div class="toggle">
          <button class="on" id="btn-docs" onclick="setView('docs')">docs</button>
          <button id="btn-copilot" onclick="setView('copilot')">copilot</button>
        </div>
      </div>
      <div class="pkg-list" id="pkg-list">
        <div class="pkg-empty">Loading...</div>
      </div>
    </aside>

    <main>
      <iframe id="doc-frame"></iframe>
      <div id="md-panel"><div class="md-body" id="md-body"></div></div>
      <div id="copilot-panel"><div class="copilot-body" id="copilot-body"></div></div>
      <div class="state" id="empty-state">
        <div class="state-icon">üìö</div>
        <div class="state-title">select a package</div>
        <div class="state-sub">use the sidebar to browse your docs</div>
      </div>
    </main>
  </div>

<script>
  let manifest = { packages: [] };
  let selected = null;
  let view = 'docs';

  // ‚îÄ‚îÄ Boot ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  async function boot() {
    try {
      const res = await fetch('./manifest.json');
      if (!res.ok) throw new Error();
      manifest = await res.json();
      renderSidebar();
    } catch {
      document.getElementById('pkg-list').innerHTML = `
        <div class="pkg-empty">
          No packages yet.<br><br>
          Run:<br>
          <code>./download-docs.sh &lt;name&gt; &lt;url&gt;</code><br><br>
          Then refresh the page.
        </div>`;
    }
  }

  // ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function renderSidebar() {
    const el = document.getElementById('pkg-list');
    if (!manifest.packages.length) {
      el.innerHTML = `<div class="pkg-empty">No packages yet. Run the script then refresh.</div>`;
      return;
    }
    el.innerHTML = manifest.packages.map(p => `
      <div class="pkg-item" id="pkg-${p.name}" onclick="selectPkg('${p.name}')">
        <span class="pkg-name">${p.name}</span>
        <span class="pkg-tag">${p.method === 'llms.txt' ? '‚ú¶ llms' : p.file_count + ' files'}</span>
      </div>`).join('');
  }

  function selectPkg(name) {
    selected = manifest.packages.find(p => p.name === name);
    document.querySelectorAll('.pkg-item').forEach(e => e.classList.remove('active'));
    document.getElementById('pkg-' + name)?.classList.add('active');
    renderContent();
  }

  function setView(v) {
    view = v;
    document.getElementById('btn-docs').classList.toggle('on', v === 'docs');
    document.getElementById('btn-copilot').classList.toggle('on', v === 'copilot');
    if (selected) renderContent();
  }

  // ‚îÄ‚îÄ Content ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function hideAll() {
    document.getElementById('doc-frame').style.display = 'none';
    document.getElementById('md-panel').style.display = 'none';
    document.getElementById('copilot-panel').style.display = 'none';
    document.getElementById('empty-state').style.display = 'none';
  }

  async function renderContent() {
    hideAll();
    const pkg = selected;

    if (view === 'copilot') { renderCopilot(pkg); return; }

    if (pkg.method === 'llms.txt') {
      // Render the single markdown file
      document.getElementById('md-panel').style.display = 'block';
      document.getElementById('md-body').innerHTML = '<div class="state"><div class="state-icon">‚è≥</div><div class="state-title">loading‚Ä¶</div></div>';
      try {
        const res = await fetch(`./${pkg.name}/markdown/all-docs.md`);
        if (!res.ok) throw new Error();
        const md = await res.text();
        document.getElementById('md-body').innerHTML = marked.parse(md);
      } catch {
        document.getElementById('md-body').innerHTML = notFoundState(pkg);
      }
    } else {
      // Show the crawled HTML in an iframe.
      // raw_index is the path wget used, eg "en/latest/index.html"
      const frame = document.getElementById('doc-frame');
      frame.style.display = 'block';
      const indexPath = pkg.raw_index || 'index.html';
      frame.src = `./${pkg.name}/raw/${indexPath}`;
    }
  }

  function notFoundState(pkg) {
    return `
      <div class="state" style="height:60vh">
        <div class="state-icon">‚ö†Ô∏è</div>
        <div class="state-title">Could not load docs</div>
        <div class="state-sub">
          Make sure you're running <code>python3.14 -m http.server 8080</code>
          from the same folder as this viewer, and that the package downloaded successfully.
        </div>
      </div>`;
  }

  function renderCopilot(pkg) {
    document.getElementById('copilot-panel').style.display = 'block';
    const files = pkg.method === 'llms.txt'
      ? [pkg.local_markdown + '/all-docs.md']
      : (pkg.markdown_files || []);

    const snippet = {
      "github.copilot.chat.codeGeneration.instructions": files.map(f => ({ file: f }))
    };
    const json = JSON.stringify(snippet, null, 2);

    const highlighted = json
      .replace(/"([^"]+)":/g, '<span class="key">"$1"</span>:')
      .replace(/: "([^"]+)"/g, ': <span class="str">"$1"</span>');

    document.getElementById('copilot-body').innerHTML = `
      <div class="copilot-heading">ü§ñ wire up ${pkg.name} to copilot</div>
      <div class="copilot-sub">
        Paste this into your project's <code>.vscode/settings.json</code>.
        Copilot will inject these files into every chat request.
      </div>
      <div class="code-block">
        <button class="copy-btn" onclick="copySnippet(${JSON.stringify(JSON.stringify(snippet))})">copy</button>${highlighted}
      </div>
      ${pkg.method !== 'llms.txt' ? `
      <div class="files-section">
        <div class="files-label">markdown files (${files.length})</div>
        <div>
          ${files.map(f => `<div class="file-chip">üìÑ ${f.split('/').pop()}</div>`).join('')}
        </div>
      </div>` : `
      <div class="files-section">
        <div class="files-label">source</div>
        <div class="file-chip">‚ú¶ llms.txt ‚Äî entire docs in one file</div>
      </div>`}
    `;
  }

  let copyTimer;
  function copySnippet(jsonStr) {
    navigator.clipboard.writeText(JSON.parse(jsonStr)).then(() => {
      const btn = document.querySelector('.copy-btn');
      btn.textContent = 'copied ‚úì';
      clearTimeout(copyTimer);
      copyTimer = setTimeout(() => { btn.textContent = 'copy'; }, 2000);
    });
  }

  boot();
</script>
</body>
</html>
